<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>CSVã‹ã‚“ãŸã‚“å¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
<style>
:root {
Â  --primary: #0066cc;
Â  --primary-hover: #0052a3;
Â  --success: #28a745;
Â  --error: #dc3545;
Â  --warning: #ffc107;
Â  --bg-light: #f8f9fa;
Â  --border: #dee2e6;
Â  --text-dark: #212529;
Â  font-size: 18px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Meiryo','Yu Gothic',sans-serif;line-height:1.8;background:var(--bg-light);padding:20px;color:var(--text-dark);}
.container{max-width:900px;margin:0 auto;}
.header{background:linear-gradient(135deg,var(--primary),#0080ff);color:white;padding:30px 25px;border-radius:12px;margin-bottom:30px;text-align:center;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.header h1{font-size:2em;margin-bottom:10px;}
.header p{font-size:1.1em;opacity:0.95;}
.font-controls{background:white;padding:15px;border-radius:8px;margin-bottom:20px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.font-controls label{font-weight:bold;margin-right:15px;font-size:1.1em;}
.font-btn{padding:10px 18px;margin:0 5px;border:2px solid var(--border);background:white;border-radius:6px;cursor:pointer;font-size:1em;font-weight:bold;transition:all 0.3s;}
.font-btn:hover{background:var(--primary);color:white;border-color:var(--primary);}
.font-btn.active{background:var(--primary);color:white;border-color:var(--primary);}
.section{background:white;padding:30px;border-radius:12px;margin-bottom:25px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.section h2{font-size:1.6em;color:var(--primary);margin-bottom:25px;padding-bottom:12px;border-bottom:3px solid var(--primary);}
.help-box{background:#fff3cd;border-left:4px solid #ffc107;padding:15px;margin-bottom:20px;border-radius:6px;}
.help-box h3{font-size:1.1em;color:#856404;margin-bottom:8px;}
.help-box ul{margin-left:20px;color:#856404;}
.help-box li{margin-bottom:5px;}
.info-box{background:#d1ecf1;border-left:4px solid #0c5460;padding:15px;margin-bottom:20px;border-radius:6px;}
.info-box h3{font-size:1.1em;color:#0c5460;margin-bottom:8px;}
.info-box ul{margin-left:20px;color:#0c5460;font-size:0.95em;}
.info-box li{margin-bottom:3px;}
.form-group{margin-bottom:25px;}
.form-label{display:block;font-size:1.2em;font-weight:bold;margin-bottom:12px;color:var(--text-dark);}
.file-input-wrapper{position:relative;border:3px dashed var(--border);border-radius:12px;padding:40px 20px;text-align:center;background:var(--bg-light);cursor:pointer;transition:all 0.3s;}
.file-input-wrapper:hover{border-color:var(--primary);background:#e3f2fd;}
.file-input-wrapper.has-file{border-color:var(--success);background:#d4edda;}
.file-input-wrapper input[type="file"]{position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;cursor:pointer;}
.file-icon{font-size:3em;margin-bottom:10px;}
.file-text{font-size:1.2em;font-weight:bold;color:var(--text-dark);}
.file-subtext{font-size:1em;color:#6c757d;margin-top:8px;}
.file-name{margin-top:15px;font-size:1.1em;color:var(--success);font-weight:bold;}
select{width:100%;padding:16px;font-size:1.2em;border:2px solid var(--border);border-radius:8px;background:white;cursor:pointer;transition:border-color 0.3s;}
select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,102,204,0.1);}
.btn-group{display:flex;gap:15px;}
.btn{width:100%;padding:18px;font-size:1.3em;font-weight:bold;border:none;border-radius:8px;cursor:pointer;transition:all 0.3s;min-height:60px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.btn-primary{background:var(--primary);color:white;}
.btn-primary:hover:not(:disabled){background:var(--primary-hover);transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.btn-primary:disabled{background:#ccc;cursor:not-allowed;opacity:0.6;}
.btn-secondary{background:#6c757d;color:white;}
.btn-secondary:hover:not(:disabled){background:#5a6268;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.btn-secondary:disabled{background:#ccc;cursor:not-allowed;opacity:0.6;}
.message{display:none;padding:20px;margin:20px 0;border-radius:8px;font-size:1.2em;font-weight:bold;border-left:5px solid;}
.message.error{background:#f8d7da;border-color:var(--error);color:#721c24;}
.message.success{background:#d4edda;border-color:var(--success);color:#155724;}
.message.warning{background:#fff3cd;border-color:#ffc107;color:#856404;}
.history-item{background:var(--bg-light);border-left:5px solid var(--primary);padding:18px 20px;margin-bottom:15px;border-radius:8px;transition:transform 0.2s;}
.history-item:hover{transform:translateX(5px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.history-date{font-size:1.15em;font-weight:bold;color:var(--primary);margin-bottom:8px;}
.history-detail{font-size:1.05em;color:var(--text-dark);margin-bottom:5px;}
.history-label{font-weight:bold;color:#6c757d;}
.no-history{text-align:center;padding:40px;color:#6c757d;font-size:1.1em;}
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:9999;}
.loading-content{text-align:center;color:white;}
.spinner{width:60px;height:60px;border:6px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading-text{font-size:1.5em;font-weight:bold;}
*:focus{outline:3px solid var(--primary);outline-offset:2px;}
.preview-section{margin-top:25px;padding-top:25px;border-top:2px solid var(--border);}
.preview-title{font-size:1.3em;font-weight:bold;color:var(--text-dark);margin-bottom:15px;}
.table-preview{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.95em;overflow-x:auto;display:block;}
.table-preview th,.table-preview td{border:1px solid var(--border);padding:10px;text-align:left;white-space:nowrap;}
.table-preview th{background:#e9ecef;font-weight:bold;position:sticky;top:0;}
.ng-cell{background:#ffe5e5;font-weight:bold;}
.ok-cell{background:#d4edda;}
.preview-note{color:#6c757d;font-size:0.95em;margin-top:10px;font-style:italic;}
.stats-box{background:var(--bg-light);border:2px solid var(--border);border-radius:8px;padding:15px;margin:20px 0;display:flex;justify-content:space-around;flex-wrap:wrap;box-shadow:0 2px 4px rgba(0,0,0,0.05);}
.stat-item{text-align:center;padding:10px;min-width:120px;}
.stat-number{font-size:2em;font-weight:bold;color:var(--primary);}
.stat-label{font-size:1em;color:#6c757d;margin-top:5px;}
@media(max-width:768px){:root{font-size:16px;}.section{padding:20px;}.btn{padding:14px;}.font-btn{margin:5px 2px;}.table-preview{font-size:0.75em;}.header h1{font-size:1.8em;}.stats-box{flex-direction:column;}.stat-item{border-bottom:1px solid var(--border);padding:15px;}.stat-item:last-child{border-bottom:none;}}
</style>
</head>
<body>

<div class="container">
Â  <div class="header">
Â  Â  <h1>ğŸ“¦ CSVã‹ã‚“ãŸã‚“å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
Â  Â  <p>åŸºå¹¹ã‚·ã‚¹ãƒ†ãƒ ã®CSVã‚’å®…é…ä¾¿ç”¨ã«å¤‰æ›ã—ã¾ã™</p>
Â  </div>

Â  <div class="font-controls">
Â  Â  <label>æ–‡å­—ã‚µã‚¤ã‚ºï¼š</label>
Â  Â  <button class="font-btn" data-size="16px">å°</button>
Â  Â  <button class="font-btn active" data-size="18px">æ¨™æº–</button>
Â  Â  <button class="font-btn" data-size="22px">å¤§</button>
Â  Â  <button class="font-btn" data-size="26px">ç‰¹å¤§</button>
Â  </div>

Â  <div class="section">
Â  Â  <h2>â“ ä½¿ã„æ–¹</h2>
Â  Â  <div class="help-box">
Â  Â  Â  <h3>ğŸ“ åŸºå¹¹ã‚·ã‚¹ãƒ†ãƒ CSVã«ã¤ã„ã¦</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>å¿…é ˆã®åˆ—ï¼šã€Œ<strong>ä½æ‰€</strong>ã€ã¨ã„ã†åˆ—åãŒå¿…è¦ã§ã™</li>
Â  Â  Â  Â  <li>ä»»æ„ã®åˆ—ï¼šã€Œéƒµä¾¿ç•ªå·ã€ã€Œé›»è©±ã€ã€Œãƒ¡ãƒ¼ãƒ«ã€ãŒã‚ã‚Œã°ãƒã‚§ãƒƒã‚¯ã—ã¾ã™</li>
Â  Â  Â  Â  <li>ä¾‹ï¼šæ°å,ä½æ‰€,é›»è©±,ãƒ¡ãƒ¼ãƒ«,éƒµä¾¿ç•ªå· ãªã©ã®åˆ—ãŒã‚ã‚‹CSVãƒ•ã‚¡ã‚¤ãƒ«</li>
Â  Â  Â  </ul>
Â  Â  </div>
Â  </div>

Â  <div class="section">
Â  Â  <h2>ğŸ”„ CSVå¤‰æ›</h2>
Â  Â  <div id="message" class="message"></div>
Â  Â Â 
Â  Â  <div class="form-group">
Â  Â  Â  <label class="form-label">1ï¸âƒ£ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
Â  Â  Â  <div class="file-input-wrapper" id="fileWrapper">
Â  Â  Â  Â  <input type="file" id="csvFile" accept=".csv">
Â  Â  Â  Â  <div class="file-icon">ğŸ“„</div>
Â  Â  Â  Â  <div class="file-text">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
Â  Â  Â  Â  <div class="file-subtext">ã¾ãŸã¯ã€ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
Â  Â  Â  Â  <div class="file-name" id="fileName"></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="form-group">
Â  Â  Â  <label class="form-label">2ï¸âƒ£ å¤‰æ›å…ˆã®å®…é…ä¼šç¤¾ã‚’é¸æŠ</label>
Â  Â  Â  <select id="courierSelect">
Â  Â  Â  Â  <option value="Yamato">ãƒ¤ãƒãƒˆé‹è¼¸</option>
Â  Â  Â  Â  <option value="Sagawa">ä½å·æ€¥ä¾¿</option>
Â  Â  Â  Â  <option value="JapanPost">æ—¥æœ¬éƒµä¾¿</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <div class="btn-group">
Â  Â  Â  <button id="convertBtn" class="btn btn-primary" disabled>
Â  Â  Â  Â  3ï¸âƒ£ å¤‰æ›ã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
Â  Â  Â  </button>
Â  Â  Â  <button id="downloadBtn" class="btn btn-secondary" style="display:none;">
Â  Â  Â  Â  4ï¸âƒ£ CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <div id="previewSection" class="preview-section" style="display:none;">
Â  Â  Â  <div class="preview-title">ğŸ“Š å¤‰æ›çµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
Â  Â  Â  <div id="statsBox" class="stats-box"></div>
Â  Â  Â  <div id="previewContent"></div>
Â  Â  Â  <p class="preview-note">â€»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æœ€åˆã®5ä»¶ã§ã™</p>
Â  Â  </div>
Â  </div>

Â  <div class="section">
Â  Â  <h2>ğŸ“œ å¤‰æ›å±¥æ­´</h2>
Â  Â  <div id="historyList"></div>
Â  </div>
</div>

<div id="loading" class="loading-overlay">
Â  <div class="loading-content">
Â  Â  <div class="spinner"></div>
Â  Â  <div class="loading-text">å‡¦ç†ä¸­ã§ã™...</div>
Â  </div>
</div>

<script>
// ==================== è¨­å®š ====================
const ADDRESS_LIMIT = {Yamato:{a1:35,a2:35},Sagawa:{a1:40,a2:40},JapanPost:{a1:50,a2:50}};
const MAX_HISTORY = 50;
const COURIER_NAMES = {'Yamato':'ãƒ¤ãƒãƒˆé‹è¼¸','Sagawa':'ä½å·æ€¥ä¾¿','JapanPost':'æ—¥æœ¬éƒµä¾¿'};

// åŸºå¹¹ã‚·ã‚¹ãƒ†ãƒ ã®åˆ—åãƒ‘ã‚¿ãƒ¼ãƒ³
const COLUMN_PATTERNS = {
Â  postalCode: ['éƒµä¾¿ç•ªå·', 'éƒµä¾¿ç•ªå·ï¼ˆåŠè§’è‹±æ•°ï¼‰', 'postalCode', 'postal'],
Â  address: ['ä½æ‰€', 'ä½æ‰€ï¼ˆéƒ½é“åºœçœŒãƒ»å»ºç‰©åå«ã‚€ï¼‰', 'address', 'Address', 'æ‰€åœ¨åœ°'],
Â  recipientName: ['æ°å', 'ãŠå±Šã‘å…ˆã®å®›å', 'å®›å', 'name', 'recipientName'],
Â  phone: ['é›»è©±ç•ªå·', 'é›»è©±', 'TEL', 'phone'],
Â  email: ['ãƒ¡ãƒ¼ãƒ«', 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', 'ãƒ¡ãƒ«ã‚¢ãƒ‰', 'email']
};

let historyData = JSON.parse(localStorage.getItem('csvHistory') || '[]');
let lastConvertedRows = [];
let lastFileName = '';

// ==================== å±¥æ­´ç®¡ç† ====================
function saveHistory(item){historyData.push(item);if(historyData.length>MAX_HISTORY) historyData.shift();localStorage.setItem('csvHistory',JSON.stringify(historyData));renderHistory();}
function renderHistory(){
Â  const div=document.getElementById('historyList'); div.innerHTML='';
Â  if(historyData.length===0){div.innerHTML='<div class="no-history">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';return;}
Â  historyData.slice().reverse().forEach(h=>{
Â  Â  const el=document.createElement('div'); el.className='history-item';
Â  Â  el.innerHTML=`<div class="history-date">${new Date(h.date).toLocaleString('ja-JP')}</div>
Â  Â  Â  <div class="history-detail"><span class="history-label">å¤‰æ›å…ˆ:</span> ${COURIER_NAMES[h.courier]||h.courier}</div>
Â  Â  Â  <div class="history-detail"><span class="history-label">å¤‰æ›ä»¶æ•°:</span> ${h.count}ä»¶</div>
Â  Â  Â  <div class="history-detail"><span class="history-label">ã‚¨ãƒ©ãƒ¼ä»¶æ•°:</span> ${h.ngCount}ä»¶</div>
Â  Â  Â  <div class="history-detail"><span class="history-label">ãƒ•ã‚¡ã‚¤ãƒ«å:</span> ${h.fileName}</div>`;
Â  Â  div.appendChild(el);
Â  });
}

// ==================== CSVå‡¦ç† ====================
function parseCsv(text){
Â  const rows=[],row=[],value='',inQuotes=false;
Â  let r=[],v='',iq=false;
Â  for(let i=0;i<text.length;i++){
Â  Â  const c=text[i],next=text[i+1];
Â  Â  if(c=='"'&&!iq){iq=true;continue;}
Â  Â  if(c=='"'&&iq){if(next=='"'){v+='"';i++;}else{iq=false;continue;}}
Â  Â  if(c==','&&!iq){r.push(v.trim());v='';continue;}
Â  Â  if((c=='\n'||c=='\r')&&!iq){if(c=='\r'&&next=='\n') i++;r.push(v.trim());if(r.some(c=>c!==''))
Â  Â  Â  rows.push(r);r=[];v='';continue;}v+=c;
Â  }
Â  if(v||r.length>0){r.push(v.trim());if(r.some(c=>c!=='')) rows.push(r);}
Â  return rows;
}

function escapeCsv(v){if(typeof v!=='string') v=String(v);return (v.includes(',')||v.includes('"')||v.includes('\n'))?`"${v.replace(/"/g,'""')}"`:v;}
function downloadCsv(rows,filename){const csv=rows.map(r=>r.map(escapeCsv).join(',')).join('\r\n');const bom=new Uint8Array([0xEF,0xBB,0xBF]);const blob=new Blob([bom,csv],{type:'text/csv;charset=utf-8'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(a.href);}

// ==================== ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ====================
function findColumnIndex(header,patterns){for(let i=0;i<header.length;i++){const col=header[i].trim();for(const p of patterns){if(col===p||col.includes(p)){return i;}}}return -1;}
function findColumns(header){return{
Â  postalCode:findColumnIndex(header,COLUMN_PATTERNS.postalCode),
Â  address:findColumnIndex(header,COLUMN_PATTERNS.address),
Â  recipientName:findColumnIndex(header,COLUMN_PATTERNS.recipientName),
Â  phone:findColumnIndex(header,COLUMN_PATTERNS.phone),
Â  email:findColumnIndex(header,COLUMN_PATTERNS.email)
};}
function checkPostalCode(postal){if(!postal)return'NG';const p=postal.replace(/[-âˆ’]/g,'');return/^\d{7}$/.test(p)?'OK':'NG';}
function checkPhone(p){if(!p)return'NG';const x=p.replace(/[-âˆ’\s()ï¼ˆï¼‰]/g,'');return(/^\d{9,11}$/.test(x))?'OK':'NG';}
function checkEmail(e){if(!e)return'NG';return(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))?'OK':'NG';}

// ==================== ä½æ‰€åˆ†å‰² ====================
function splitAddress(address,courier){if(!address)return['',''];const lim=ADDRESS_LIMIT[courier]||{a1:35,a2:35};if(address.length<=lim.a1)return[address,''];const sub=address.substring(0,lim.a1);const matches=[...sub.matchAll(/[\s\-âˆ’ã€€ãƒ¼ã€ã€‚]/g)];if(matches.length>0){const last=matches[matches.length-1];const splitPoint=last.index+1;if(splitPoint>lim.a1/2){return[address.substring(0,splitPoint).trim(),address.substring(splitPoint).trim()];}}return[address.substring(0,lim.a1).trim(),address.substring(lim.a1).trim()];}

// ==================== ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ====================
function renderPreview(rows,courier,columns){
Â  const previewDiv=document.getElementById('previewContent'); const previewSection=document.getElementById('previewSection');
Â  const statsBox=document.getElementById('statsBox');
Â  previewDiv.innerHTML=''; previewSection.style.display='block';
Â  const table=document.createElement('table');table.className='table-preview';
Â  const thead=document.createElement('thead');const trh=document.createElement('tr');
Â  ['ãƒã‚§ãƒƒã‚¯çµæœ',...rows[0]].forEach(h=>{const th=document.createElement('th');th.textContent=h;trh.appendChild(th);});
Â  thead.appendChild(trh);table.appendChild(thead);
Â  const tbody=document.createElement('tbody'); let totalNg=0; const maxRows=Math.min(rows.length-1,5);
Â  for(let i=1;i<=maxRows;i++){
Â  Â  const row=rows[i];const tr=document.createElement('tr'); let rowNg=false;
Â  Â  const tdStatus=document.createElement('td');
Â  Â  rows[0].forEach((h,j)=>{const td=document.createElement('td');td.textContent=row[j];tr.appendChild(td);});
Â  Â  const postalStatus=checkPostalCode(row[columns.postalCode]);
Â  Â  const phoneStatus=checkPhone(row[columns.phone]);
Â  Â  const emailStatus=checkEmail(row[columns.email]);
Â  Â  const [a1,a2]=splitAddress(row[columns.address]||'',courier);
Â  Â  if(postalStatus==='NG'||phoneStatus==='NG'||emailStatus==='NG'||a2!==''){rowNg=true;totalNg++;}
Â  Â  tdStatus.textContent=rowNg?'âš ï¸NG':'âœ…OK';tdStatus.className=rowNg?'ng-cell':'ok-cell';
Â  Â  tr.prepend(tdStatus);
Â  Â  tbody.appendChild(tr);
Â  }
Â  table.appendChild(tbody);previewDiv.appendChild(table);
Â  return totalNg;
}
</script>
</body>
</html>